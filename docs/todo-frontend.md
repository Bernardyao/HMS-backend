# 前端 TODO（React）— HIS

> 范围：对应当前数据库 9 表与门诊闭环。
> 目标：前端交付可演示、可联调、可验收的核心工作站/管理端。

---

## P0（本迭代必须完成）

### 1) 项目骨架与工程规范
- 建立目录结构：`pages/`（按业务域）、`components/`、`services/`（API）、`types/`（DTO）、`utils/`、`auth/`（权限）。
- 路由与布局：登录页 + 主工作台（最少 1 套布局）；未登录强制跳转。
- 请求层：统一 `fetch/axios` 封装（baseURL、超时、统一错误处理、请求/响应拦截）。

### 2) 枚举与字段校验“单一来源”
- 将通用枚举固化为常量与展示映射：
  - `gender`、`status`、`visit_type`、`registration.status`、`medical_record.status`、`prescription_type`、`prescription.status`、`charge_type`、`payment_method`、`charge.status`。
- 表单校验落地（前置拦截）：必填、长度、格式（手机号/邮箱/身份证），并能映射后端字段级错误。

### 3) 核心页面（最小闭环）
- 主数据
  - 科室管理：列表/新增/编辑/启停用
  - 医生管理：列表/新增/编辑/按科室筛选
  - 患者建档：列表/新增/编辑/按手机号或身份证查询
  - 药品管理：列表/新增/编辑/库存展示
- 门诊闭环
  - 挂号：创建/取消/列表（按 `visit_date + status + department` 筛选）
  - 病历：按挂号进入；实现“先查后建”（一对一约束）；草稿/提交/审核
  - 处方：从病历进入；处方主从编辑；开方/审核/发药状态按钮
  - 收费：创建收费单；支付回写录入（模拟也可）；退费流程

### 4) 隐私脱敏与权限（MVP）
- 患者手机号/身份证默认脱敏展示；详情页按权限显示明文。
- UI 权限开关：至少区分“医生 / 收费员 / 管理员”的菜单与操作按钮。

### 5) 联调与冒烟
- 产出 1 份前端冒烟清单（可直接由测试/交付执行）：
  - 患者建档 → 挂号 → 病历 → 处方 → 收费（含退费与取消挂号）。
- 与后端对齐：分页、排序、时间字段格式、错误码结构。

---

## P1（2–3 周内完成）

### 1) 体验与一致性
- 统一表格与表单交互：加载态、空态、错误态、确认删除（软删）提示。
- 字段级错误提示规范化：后端返回 `{code, message, fieldErrors}` 时前端可就地提示。

### 2) 关键并发与幂等提示
- 支付回写重复提交：前端侧禁止重复点击/重复提交，并对幂等失败给出可理解提示。
- 处方明细金额：前端计算 `unit_price * quantity` 仅用于展示；以“后端复算”为准。

### 3) 权限细化
- 细化到资源级（例如：仅收费员可退费；仅审核医生可审核处方）。

---

## P2（持续优化）

- 可观测性：前端埋点（关键链路耗时/错误率）与错误上报（按院方合规要求）。
- 性能：列表虚拟滚动、缓存常用字典、减少重复请求。
- 可维护性：生成 API Client（基于 OpenAPI）与 DTO 类型对齐。

---

## 联调输入（前端依赖后端提供）

- 接口契约（字段、枚举、错误码、分页）
- 登录与权限信息结构（例如返回 `roles/permissions`）
- 统一时间格式（建议 ISO 8601；如后端返回 `TIMESTAMPTZ` 则需明确时区显示规则）

参考：
- docs/frontend-data-dictionary.md
- docs/backend-db-reference.md
