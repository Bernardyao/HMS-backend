<?xml version="1.0" encoding="UTF-8"?>
<FindBugsFilter>
    <!--
        SpotBugs排除规则

        排除一些不太重要或误报的检查项
    -->

    <!-- 排除Lombok生成的代码相关问题 -->
    <Match>
        <Class name="~.*\.+.*"/>
        <Bug pattern="SE_BAD_FIELD"/>
    </Match>

    <!-- 排除测试代码的某些检查 -->
    <Match>
        <Class name="~.*Test.*"/>
        <Bug pattern="RCN_REDUNDANT_NULLCHECK_OF_NONNULL_VALUE"/>
    </Match>

    <!-- 排除实体类的EI/EI2警告（JPA实体需要直接暴露字段） -->
    <Match>
        <Class name="~.*\.entity\..*"/>
        <Bug code="EI,EI2"/>
    </Match>

    <!-- 排除VO类的EI/EI2警告（DTO需要直接暴露字段） -->
    <Match>
        <Class name="~.*\.vo\..*"/>
        <Bug code="EI,EI2"/>
    </Match>

    <!-- 排除序列化相关的警告（对于实体类） -->
    <Match>
        <Class name="~.*\.entity\..*"/>
        <Bug pattern="SE_TRANSIENT_FIELD_NOT_RESTORED"/>
    </Match>

    <!-- 排除Spring自动注入的null检查 -->
    <Match>
        <Class name="~.*\.service\..*"/>
        <Bug pattern="NP_UNSHOULDEN_NONNULL_PARAMETER"/>
    </Match>

    <!-- 排除Spring Bean构造器注入的EI2警告（暴露内部表示） -->
    <!-- Spring管理的依赖是线程安全的，使用final字段确保不可变性 -->
    <Match>
        <Class name="com.his.service.impl.AuditLogServiceImpl"/>
        <Bug pattern="EI2"/>
    </Match>
    <Match>
        <Class name="com.his.service.impl.AuditLogQueryServiceImpl"/>
        <Bug pattern="EI2"/>
    </Match>
    <Match>
        <Class name="com.his.monitoring.LoggingMetricsReporter"/>
        <Bug pattern="EI2"/>
    </Match>
    <Match>
        <Class name="com.his.scheduled.AuditLogCleanupTask"/>
        <Bug pattern="EI2"/>
    </Match>
    <Match>
        <Class name="com.his.log.aspect.ApiLogAspect"/>
        <Bug pattern="EI2"/>
    </Match>

    <!-- 排除工具类的Finalizer攻击警告（工具类不应被实例化） -->
    <Match>
        <Class name="com.his.common.SecurityUtils"/>
        <Bug pattern="CT_CONSTRUCTING_SELF"/>
    </Match>

    <!-- 排除懒加载初始化方法的警告（故意设计的） -->
    <Match>
        <Method name="initializeLazyFields" params="com.his.entity.MedicalRecord"/>
        <Bug pattern="UC_USELESS_VOID_METHOD, DLS_DEAD_LOCAL_STORE"/>
    </Match>
    <Match>
        <Method name="initializeLazyFields" params="com.his.entity.Prescription"/>
        <Bug pattern="UC_USELESS_VOID_METHOD, DLS_DEAD_LOCAL_STORE"/>
    </Match>

    <!-- 排除Short比较的警告（Short对象缓存问题） -->
    <Match>
        <Class name="com.his.service.impl.RegistrationServiceImpl"/>
        <Bug pattern="RC_REF_COMPARISON"/>
    </Match>
</FindBugsFilter>
