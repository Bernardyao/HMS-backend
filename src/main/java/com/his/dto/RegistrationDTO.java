package com.his.dto;

import io.swagger.v3.oas.annotations.media.Schema;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;
import lombok.Data;

import java.io.Serializable;
import java.math.BigDecimal;

/**
 * 挂号请求数据传输对象
 *
 * <p>用于患者挂号时提交的完整信息，包括患者基本信息、挂号信息和支付信息</p>
 *
 * <h3>主要功能</h3>
 * <ul>
 *   <li><b>患者建档</b>：新患者首次就诊时自动建立患者档案</li>
 *   <li><b>挂号登记</b>：记录患者挂号信息，分配医生和科室</li>
 *   <li><b>费用收取</b>：收取挂号费，支持多种支付方式</li>
 *   <li><b>信息验证</b>：验证患者信息的完整性和有效性</li>
 * </ul>
 *
 * <h3>使用场景</h3>
 * <ul>
 *   <li><b>现场挂号</b>：患者在挂号窗口现场挂号</li>
 *   <li><b>预约挂号</b>：患者提前预约指定医生的号源</li>
 *   <b>自助挂号</b>：患者在自助机上自行挂号</li>
 *   <li><b>网上挂号</b>：通过手机APP或网站进行挂号</li>
 * </ul>
 *
 * <h3>验证规则</h3>
 * <ul>
 *   <li><b>必填字段</b>：患者姓名、身份证号、性别、年龄、联系电话、科室ID、医生ID、挂号费</li>
 *   <li><b>格式验证</b>：身份证号必须符合18位标准格式，手机号必须为11位数字</li>
 *   <li><b>业务验证</b>：科室和医生必须存在且有效，医生必须属于该科室</li>
 *   <li><b>数据校验</b>：性别值必须在0、1、2范围内，年龄必须大于0</li>
 * </ul>
 *
 * <h3>业务说明</h3>
 * <ul>
 *   <li>首次就诊患者：系统会自动创建患者档案</li>
 *   <li>再次就诊患者：系统会更新患者信息</li>
 *   <li>支持预约挂号和现场挂号两种模式</li>
 *   <li>挂号成功后生成唯一的挂号单号</li>
 * </ul>
 *
 * @author HIS 开发团队
 * @version 1.0
 * @since 1.0
 */
@Schema(description = "挂号请求数据传输对象")
@Data
public class RegistrationDTO implements Serializable {

    private static final long serialVersionUID = 1L;

    // ============ 患者信息（用于建档） ============

    /**
     * 患者姓名
     *
     * <p>患者的真实姓名，用于建立患者档案和就诊记录</p>
     *
     * <p><b>验证规则：</b></p>
     * <ul>
     *   <li><b>必填字段</b>：不能为空</li>
     *   <li><b>格式要求</b>：中文姓名或英文姓名，2-50个字符</li>
     *   <li><b>内容规则</b>：不能包含特殊字符和数字</li>
     *   <li><b>业务规则</b>：应与身份证号上的姓名一致</li>
     * </ul>
     *
     * <p><b>示例</b>：李明、王芳、张伟</p>
     */
    @NotBlank(message = "患者姓名不能为空")
    @Schema(description = "患者姓名", example = "李明")
    private String patientName;

    /**
     * 身份证号
     *
     * <p>患者的身份证号码，用于身份识别和患者档案管理</p>
     *
     * <p><b>验证规则：</b></p>
     * <ul>
     *   <li><b>必填字段</b>：不能为空</li>
     *   <li><b>格式要求</b>：18位身份证号码（或15位旧版）</li>
     *   <li><b>格式校验</b>：符合身份证号码编码规则</li>
     *   <li><b>校验位验证</b>：最后一位校验位必须正确</li>
     *   <li><b>唯一性</b>：在系统中唯一标识一个患者</li>
     * </ul>
     *
     * <p><b>业务说明：</b></p>
     * <ul>
     *   <li>用于查询患者历史就诊记录</li>
     *   <li>用于医保结算和报销</li>
     *   <li>系统会根据身份证号判断患者是否已建档</li>
     *   <li>从身份证号中自动提取性别和出生日期</li>
     * </ul>
     *
     * <p><b>示例</b>：110101199001011001（18位标准身份证号）</p>
     */
    @NotBlank(message = "身份证号不能为空")
    @Schema(description = "身份证号", example = "110101199001011001")
    private String idCard;

    /**
     * 性别
     *
     * <p>患者的性别，用于医疗决策和药品配伍</p>
     *
     * <p><b>性别说明：</b></p>
     * <ul>
     *   <li><b>0 - 女性</b>：女患者</li>
     *   <li><b>1 - 男性</b>：男患者</li>
     *   <li><b>2 - 未知</b>：性别未知或信息不全</li>
     * </ul>
     *
     * <p><b>验证规则：</b></p>
     * <ul>
     *   <li><b>必填字段</b>：不能为空</li>
     *   <li><b>取值范围</b>：0、1、2</li>
     *   <li><b>业务规则</b>：通常与身份证号中的性别码一致</li>
     * </ul>
     *
     * <p><b>医疗意义：</b></p>
     * <ul>
     *   <li>影响某些疾病的诊断和治疗方案</li>
     *   <li>影响药品的选择和剂量</li>
     *   <li>某些检查项目有性别差异</li>
     * </ul>
     *
     * <p><b>示例</b>：1（表示男性）</p>
     */
    @NotNull(message = "性别不能为空")
    @Schema(description = "性别（0=女, 1=男, 2=未知）",
            example = "1",
            allowableValues = {"0", "1", "2"})
    private Short gender;

    /**
     * 年龄
     *
     * <p>患者的实际年龄，用于医疗决策和用药剂量计算</p>
     *
     * <p><b>验证规则：</b></p>
     * <ul>
     *   <li><b>必填字段</b>：不能为空</li>
     *   <li><b>格式要求</b>：短整型数值</li>
     *   <li><b>取值范围</b>：0-150（正常人类年龄范围）</li>
     *   <li><b>业务规则</b>：通常根据身份证号自动计算</li>
     * </ul>
     *
     * <p><b>医疗意义：</b></p>
     * <ul>
     *   <li>影响药物剂量的计算（特别是儿童和老年人）</li>
     *   <li>影响某些检查项目的选择</li>
     *   <li>不同年龄段的常见疾病不同</li>
     *   <li>儿童用药需要特别注意安全性</li>
     * </ul>
     *
     * <p><b>示例</b>：34（表示34岁）</p>
     */
    @NotNull(message = "年龄不能为空")
    @Schema(description = "年龄", example = "34")
    private Short age;

    /**
     * 联系电话
     *
     * <p>患者的手机号码，用于就诊通知、报告查询和紧急联系</p>
     *
     * <p><b>验证规则：</b></p>
     * <ul>
     *   <li><b>必填字段</b>：不能为空</li>
     *   <li><b>格式要求</b>：11位手机号码</li>
     *   <li><b>格式校验</b>：必须为1开头的11位数字</li>
     *   <li><b>运营商验证</b>：有效的手机号段</li>
     * </ul>
     *
     * <p><b>业务用途：</b></p>
     * <ul>
     *   <li>发送就诊提醒和通知</li>
     *   <li>查询检查检验报告</li>
     *   <li>紧急情况下联系患者</li>
     *   <li>发送处方和用药指导</li>
     * </ul>
     *
     * <p><b>示例</b>：13912345678</p>
     */
    @NotBlank(message = "联系电话不能为空")
    @Schema(description = "联系电话", example = "13912345678")
    private String phone;

    // ============ 挂号信息 ============

    /**
     * 科室ID
     *
     * <p>患者选择就诊的科室唯一标识</p>
     *
     * <p><b>验证规则：</b></p>
     * <ul>
     *   <li><b>必填字段</b>：不能为空</li>
     *   <li><b>格式要求</b>：长整型数值</li>
     *   <li><b>业务规则</b>：必须对应系统中已存在的有效科室</li>
     *   <li><b>状态验证</b>：科室必须为开放状态（可挂号）</li>
     * </ul>
     *
     * <p><b>业务说明：</b></p>
     * <ul>
     *   <li>患者根据症状选择相应科室</li>
     *   <li>某些科室可能有挂号限制（如专科门诊）</li>
     *   <li>科室确定后可选择该科室的医生</li>
     *   <li>普通门诊和专家门诊费用可能不同</li>
     * </ul>
     *
     * <p><b>示例</b>：1（内科）、10（外科）</p>
     */
    @NotNull(message = "科室ID不能为空")
    @Schema(description = "科室ID", example = "1")
    private Long deptId;

    /**
     * 医生ID
     *
     * <p>患者选择就诊的医生唯一标识</p>
     *
     * <p><b>验证规则：</b></p>
     * <ul>
     *   <li><b>必填字段</b>：不能为空</li>
     *   <li><b>格式要求</b>：长整型数值</li>
     *   <li><b>业务规则</b>：必须对应系统中已存在的有效医生</li>
     *   <li><b>归属验证</b>：医生必须属于选定的科室</li>
     *   <li><b>排班验证</b>：医生当天必须有出诊排班</li>
     * </ul>
     *
     * <p><b>业务说明：</b></p>
     * <ul>
     *   <li>患者可以指定医生，也可以选择"不限"</li>
     *   <li>专家号只能选择专家级别的医生</li>
     *   <li>医生有每日挂号数量限制</li>
     *   <li>部分医生可能需要提前预约</li>
     * </ul>
     *
     * <p><b>示例</b>：1（张医生）、5（李医生）</p>
     */
    @NotNull(message = "医生ID不能为空")
    @Schema(description = "医生ID", example = "1")
    private Long doctorId;

    /**
     * 挂号费
     *
     * <p>本次挂号需要支付的费用，根据科室和医生级别确定</p>
     *
     * <p><b>验证规则：</b></p>
     * <ul>
     *   <li><b>必填字段</b>：不能为空</li>
     *   <li><b>格式要求</b>：BigDecimal类型，确保精度</li>
     *   <li><b>取值范围</b>：大于0的数值</li>
     *   <li><b>精度要求</b>：保留2位小数（精确到分）</li>
     *   <li><b>业务规则</b>：不能超过物价部门规定的标准</li>
     * </ul>
     *
     * <p><b>费用类型：</b></p>
     * <ul>
     *   <li><b>普通门诊</b>：普通挂号费，如10-20元</li>
     *   <li><b>专家门诊</b>：专家挂号费，如50-200元</li>
     *   <li><b>特需门诊</b>：特需挂号费，如300-500元</li>
     *   <li><b>急诊</b>：急诊挂号费，通常高于普通门诊</li>
     * </ul>
     *
     * <p><b>示例</b>：20.00（表示挂号费20元）</p>
     */
    @NotNull(message = "挂号费不能为空")
    @Schema(description = "挂号费（单位：元）", example = "20.00")
    private BigDecimal regFee;

    // ============ 支付信息（挂号即收费） ============

    /**
     * 支付方式
     *
     * <p>患者支付挂号费的方式，支持现金、银行卡、微信、支付宝等</p>
     *
     * <p><b>支付方式说明：</b></p>
     * <ul>
     *   <li><b>1 - 现金</b>：现金支付</li>
     *   <li><b>2 - 银行卡</b>：银行卡刷卡支付</li>
     *   <li><b>3 - 微信</b>：微信扫码支付</li>
     *   <li><b>4 - 支付宝</b>：支付宝扫码支付</li>
     * </ul>
     *
     * <p><b>验证规则：</b></p>
     * <ul>
     *   <li><b>必填程度</b>：可选字段</li>
     *   <li><b>取值范围</b>：1、2、3、4</li>
     *   <li><b>业务规则</b>：如不传则创建待支付挂号单，后续再支付</li>
     * </ul>
     *
     * <p><b>支付模式：</b></p>
     * <ul>
     *   <li><b>立即支付</b>：挂号时选择支付方式，立即完成支付</li>
     *   <li><b>延后支付</b>：不传支付方式，先挂号后支付（待支付模式）</li>
     *   <li>通常现场挂号采用立即支付，网上挂号可采用延后支付</li>
     * </ul>
     *
     * <p><b>示例</b>：3（表示使用微信支付）</p>
     */
    @Schema(description = "支付方式（1=现金, 2=银行卡, 3=微信, 4=支付宝, 5=医保）",
            example = "3",
            allowableValues = {"1", "2", "3", "4", "5"})
    private Short paymentMethod;

    /**
     * 交易流水号
     *
     * <p>第三方支付平台返回的交易凭证，用于对账和查询</p>
     *
     * <p><b>验证规则：</b></p>
     * <ul>
     *   <li><b>必填程度</b>：非现金支付时建议填写</li>
     *   <li><b>格式要求</b>：文本格式，建议不超过100字符</li>
     *   <li><b>唯一性</b>：每个交易流水号在系统中唯一</li>
     *   <li><b>匹配规则</b>：需与选择的支付方式对应</li>
     * </ul>
     *
     * <p><b>业务说明：</b></p>
     * <ul>
     *   <li>记录第三方支付的交易凭证号</li>
     *   <li>用于查询支付状态和结果</li>
     *   <li>用于处理退款和纠纷</li>
     *   <li>现金支付时无需填写</li>
     *   <li>网上支付时由支付平台自动生成</li>
     * </ul>
     *
     * <p><b>示例</b>：WX2025123110012001（微信支付交易号）</p>
     */
    @Schema(description = "交易流水号", example = "WX2025123110012001")
    private String transactionNo;
}
