# ============================================================
# Integration Test Environment Configuration
# ============================================================
# 集成测试使用真实PostgreSQL数据库，确保与生产环境一致

server:
  port: 8081

spring:
  # 数据源配置 - 集成测试（连接真实PostgreSQL数据库）
  datasource:
    url: jdbc:postgresql://localhost:5432/his_project_test
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:123456}
    driver-class-name: org.postgresql.Driver

    hikari:
      minimum-idle: 2
      maximum-pool-size: 5
      connection-timeout: 30000
      connection-test-query: SELECT 1

  # JPA/Hibernate 配置
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: none  # 关键：完全由Flyway管理表结构，Hibernate只负责验证
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true
        generate_statistics: false

  # Flyway 配置 - 集成测试启用（自动迁移数据库）
  flyway:
    enabled: true  # 关键：启用Flyway自动建表
    locations: classpath:db/migration
    baseline-on-migrate: true  # 允许在空数据库上运行迁移
    baseline-version: 0
    clean-disabled: false  # 测试环境允许清理（可选）
    validate-on-migrate: true  # 迁移前校验

# 日志配置
logging:
  level:
    root: INFO
    com.his: DEBUG
    org.hibernate.SQL: DEBUG
    org.springframework.test: DEBUG
    org.flywaydb: DEBUG  # 显示Flyway迁移日志
